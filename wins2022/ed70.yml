- name: Copy EDVS2019 7.0 Installer to EC2 Instance
  win_copy:
    src: /products/edvs2019_70.exe
    dest: C:\temp\

- name: Install EDVS2019 7.0
  win_package:
    path: C:\temp\edvs2019_70.exe
    state: present
    arguments: /passive

- name: Copy EDE 7.0 Installer to EC2 Instance
  win_copy:
    src: /products/ede_70.exe
    dest: C:\temp\

- name: Install EDE 7.0
  win_package:
    path: C:\temp\ede_70.exe
    state: present
    arguments: /passive

- name: Add License Server
  win_lineinfile:
    path: C:\ProgramData\Micro Focus\ces.ini
    regex: '^lshost'
    line: 'lshost = {{ licenseServer }}'

- name: Import JCL Region
  win_command:
    cmd: '"C:\Program Files (x86)\Micro Focus\Enterprise Developer\bin\mfds.exe" -g 5 C:\MFSamples\JCL\JCL.xml'
    chdir: C:\MFSamples\JCL
  
- name: Stop MFDS Service
  ansible.windows.win_service:
    name: mf_CCITCP2
    state: stopped

- name: Enable ESMAC UI
  win_command:
    cmd: '"C:\Program Files (x86)\Micro Focus\Enterprise Developer\bin\mfds.exe" --UI-on'

- name: Enable ESMAC Listen All
  win_command:
    cmd: '"C:\Program Files (x86)\Micro Focus\Enterprise Developer\bin\mfds.exe" --listen-all'

- name: Start MFDS Service
  ansible.windows.win_service:
    name: mf_CCITCP2
    state: started

- name: Stop ESCWA Service
  ansible.windows.win_service:
    name: escwa
    state: stopped

- name: Enable ESCWA Listen All
  win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Services\escwa
    name: imagePath  
    data: '"C:\Program Files (x86)\Micro Focus\Enterprise Developer\bin\escwa.exe" -s --BasicConfig.MfRequestedEndpoint="tcp:*:10086" --write=true'
    type: expandstring

- name: Start ESCWA Service
  ansible.windows.win_service:
    name: escwa
    state: started

- name: Copy EDVS2019 7.0 PU 15 Installer to EC2 Instance
  win_copy:
    src: /products/edvs2019_70_pu15_315341.exe
    dest: C:\temp\
  tags: ed70pu15

- name: Install EDVS2019 7.0 PU 15
  win_package:
    path: C:\temp\edvs2019_70_pu15_315341.exe
    state: present
    arguments: /passive
  tags: ed70pu15

- name: Copy EDE 7.0 PU 15 Installer to EC2 Instance
  win_copy:
    src: /products/ede_70_pu15_315321.exe
    dest: C:\temp\
  tags: ed70pu15

- name: Install EDE 7.0 PU 15
  win_package:
    path: C:\temp\ede_70_pu15_315321.exe
    state: present
    arguments: /passive
  tags: ed70pu15
