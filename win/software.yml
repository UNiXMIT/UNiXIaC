- name: Package Installation
  win_chocolatey:
    name: 
    # - googlechrome
    - firefox
    - procmon
    - procexp
    - vcredist140
    - 7zip
    - winscp
    - notepadplusplus
    - jq
    - cascadiamono
    - ntop.portable
    - psqlodbc
    # - dotnet
    # - windows-sdk-11-version-22h2-all
    # - visualstudio2017buildtools
    # - office365business
    # - powertoys
    # - adobereader
    # - linkshellextension
    # - dotpeek
    # - tinytask
    # - speedtest
    # - clumsy
    state: present
  ignore_errors: true

- name: Install New Windows Terminal
  ansible.windows.win_powershell:
    script: |
      $msTermVer = "1.18.3181.0"
      $msTermURL = "https://github.com/microsoft/terminal/releases/download/v${msTermVer}/Microsoft.WindowsTerminal_${msTermVer}_x64.zip"
      Invoke-WebRequest -Uri $msTermURL -outfile C:\Users\Public\Documents\Microsoft.WindowsTerminal.zip
      Expand-Archive -LiteralPath C:\Users\Public\Documents\Microsoft.WindowsTerminal.zip -DestinationPath C:\Users\Public\Documents
      setx /m PATH "$env:PATH;C:\Users\Public\Documents\terminal-${msTermVer}"

- name: Download Oracle Instant Client 32bit
  ansible.windows.win_get_url:
    url: https://download.oracle.com/otn_software/nt/instantclient/2112000/instantclient-basic-nt-21.12.0.0.0dbru.zip
    dest: C:\Users\Public\Documents\instantclient-basic-nt-21.12.0.0.0dbru.zip

- name: Download Oracle Instant Client 64bit
  ansible.windows.win_get_url:
    url: https://download.oracle.com/otn_software/nt/instantclient/2112000/instantclient-basic-windows.x64-21.12.0.0.0dbru.zip
    dest: C:\Users\Public\Documents\instantclient-basic-windows.x64-21.12.0.0.0dbru.zip

- name: Unzip Oracle Instant Client 32bit
  community.windows.win_unzip:
    src: C:\Users\Public\Documents\instantclient-basic-nt-21.12.0.0.0dbru.zip
    dest: C:\instantClient32

- name: Unzip Oracle Instant Client 64bit
  community.windows.win_unzip:
    src: C:\Users\Public\Documents\instantclient-basic-windows.x64-21.12.0.0.0dbru.zip
    dest: C:\instantClient64

- name: Download Oracle Instant Client ODBC 32bit
  ansible.windows.win_get_url:
    url: https://download.oracle.com/otn_software/nt/instantclient/2112000/instantclient-odbc-nt-21.12.0.0.0dbru.zip
    dest: C:\Users\Public\Documents\instantclient-basic-nt-21.12.0.0.0dbru.zip

- name: Download Oracle Instant Client ODBC 64bit
  ansible.windows.win_get_url:
    url: https://download.oracle.com/otn_software/nt/instantclient/2112000/instantclient-odbc-windows.x64-21.12.0.0.0dbru.zip
    dest: C:\Users\Public\Documents\instantclient-basic-windows.x64-21.12.0.0.0dbru.zip

- name: Unzip Oracle Instant Client ODBC 32bit
  community.windows.win_unzip:
    src: C:\Users\Public\Documents\instantclient-basic-nt-21.12.0.0.0dbru.zip
    dest: C:\instantClient32

- name: Unzip Oracle Instant Client ODBC 64bit
  community.windows.win_unzip:
    src: C:\Users\Public\Documents\instantclient-basic-windows.x64-21.12.0.0.0dbru.zip
    dest: C:\instantClient64\

- name: Install Oracle Instant Client ODBC 32bit
  ansible.windows.win_command: odbc_install.exe
  args:
    chdir: C:\instantClient32\instantclient_21_12

- name: Install Oracle Instant Client ODBC 64bit
  ansible.windows.win_command: odbc_install.exe
  args:
    chdir: C:\instantClient64\instantclient_21_12

- name: Get 32bit DB2 ODBC Driver Download URL from S3
  amazon.aws.s3_object:
    profile: '{{ awsProfile }}'
    bucket: mturner
    mode: geturl
    object: DB2/v11.5.9_nt32_odbc_cli.zip
    region: '{{ awsRegion }}'
    expiry: 4000
    sig_v4: true
  register: s332
  delegate_to: localhost

- name: Get 64bit DB2 ODBC Driver Download URL from S3
  amazon.aws.s3_object:
    profile: '{{ awsProfile }}'
    bucket: mturner
    mode: geturl
    object: DB2/v11.5.9_ntx64_odbc_cli.zip
    region: '{{ awsRegion }}'
    expiry: 4000
    sig_v4: true
  register: s364
  delegate_to: localhost

- name: Create DB2
  win_file:
    path: C:\db2cli
    state: directory

- name: Create DB2 32
  win_file:
    path: C:\db2cli\32
    state: directory

- name: Create DB2 64
  win_file:
    path: C:\db2cli\64
    state: directory

- name: Everyone permissions on DB2
  win_acl:
    user: Everyone
    path: C:\db2cli
    type: allow
    rights: FullControl

- name: Download 32bit DB2 ODBC Driver
  ansible.windows.win_get_url:
    url: '{{ s332.url }}'
    dest: C:\db2cli\32

- name: Download 64bit DB2 ODBC Driver
  ansible.windows.win_get_url:
    url: '{{ s364.url }}'
    dest: C:\db2cli\64

- name: Extract 32bit DB2 ODBC Driver
  community.windows.win_unzip:
    src: C:\db2cli\32\v11.5.9_nt32_odbc_cli.zip
    dest: C:\db2cli\32

- name: Extract 64bit DB2 ODBC Driver
  community.windows.win_unzip:
    src: C:\db2cli\64\v11.5.9_ntx64_odbc_cli.zip
    dest: C:\db2cli\64

- name: Install 32bit DB2 ODBC Driver
  win_command:
    cmd: db2cli install -setup
    chdir: C:\db2cli\32\clidriver\bin

- name: Install 64bit DB2 ODBC Driver
  win_command:
    cmd: db2cli install -setup
    chdir: C:\db2cli\64\clidriver\bin