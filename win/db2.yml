- name: Get DB2 Client Installer Download URL from S3
  amazon.aws.s3_object:
    profile: '{{ awsProfile }}'
    bucket: mturner
    mode: geturl
    object: DB2/v11.5.9_ntx64_client.exe
    region: eu-west-2
    expiry: 4000
    sig_v4: true
  register: s3
  delegate_to: localhost

- name: Download DB2 Client Installer
  ansible.windows.win_get_url:
    url: '{{ s3.url }}'
    dest: C:\Users\Public\Documents

- name: Extract DB2 Client Installer
  win_command:
    cmd: v11.5.9_ntx64_client.exe /auto .
    chdir: C:\Users\Public\Documents

- name: Create DB2 Response File
  win_copy:
    content: |
      PROD=CLIENT
      LIC_AGREEMENT=ACCEPT
      FILE=C:\Program Files\IBM\SQLLIB\
      INSTALL_TYPE=CUSTOM
      COMP=BASE_CLIENT
    dest: C:\Users\Public\Documents\CLIENT\db2.win.rsp

- name: Install DB2 Client
  win_command:
    cmd: setup -u db2.win.rsp
    chdir: C:\Users\Public\Documents\CLIENT