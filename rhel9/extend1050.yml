- name: S3 Management
  hosts: local
  - name: Get extend 10.5.0 Download URL from S3
    amazon.aws.s3_object:
      profile: '{{ awsProfile }}'
      bucket: mturner
      mode: geturl
      object: AcuCOBOL/1050/PU1/setup_acucob1050pmk59shACU
      region: '{{ awsRegion }}'
      expiry: 4000
      sig_v4: true
    register: s3

  - name: Set S3 URL Variable
    set_fact: S3URL={{ s3.url }}

- name: extend 10.5.0
  hosts: awsEC2
  - name: Create extend 10.5.0 directory
    file:
      path: /home/products/acu1050shx64
      state: directory
      owner: support 
      group: support
      mode: '0775'

  - name: Download extend 10.5.0 Installer
    ansible.builtin.get_url:
      url: "{{ hostvars['local'].S3URL }}"
      dest: /home/products/acu1050shx64/setup_acucob1050pmk59shACU
      
  - name: Install extend 10.5.0
    shell: "printf 'y\n/home/products/acu1050shx64\n' | /home/products/acu1050shx64/setup_acucob1050pmk59shACU"

  - name: Activate Licenses
    shell: "printf '{{ extendCode }}\n{{ extendKey }}\n' | /home/products/acu1050shx64/bin/activator"