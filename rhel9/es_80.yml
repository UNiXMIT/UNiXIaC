- name: Copy ES 8.0 PU 3 Installer to EC2 Instance
  copy:
    src: /products/setup_ent_server_8.0_patchupdate05_318651_redhat_x86_64
    dest: "/home/{{ myUsername }}/MFSupport/MFInstallers/setup_ent_server_8.0_patchupdate05_318651_redhat_x86_64"
    owner: support 
    group: support
    mode: '0775'

- name: Install ES 8.0 PU 3
  command: "/home/{{ myUsername }}/MFSupport/MFInstallers/setup_ent_server_8.0_patchupdate05_318651_redhat_x86_64 -IacceptEULA -ESadminID={{ myUsername }} -il={{ installPath }}"

- name: Add License Server
  lineinfile:
    path: /var/microfocuslicensing/bin/ces.ini
    state: present
    regexp: '^lshost'
    line: 'lshost = {{ licenseServer }}'

- name: Start MFDS
  command: tmux new -d -s mfds ". {{ installPath }}/bin/cobsetenv && {{ installPath }}/bin/mfds"
  environment: 
    COBDIR: '{{ installPath }}'

- name: Import JCL Region
  command: '{{ installPath }}/bin/mfds -g 5 /home/{{ myUsername }}/MFSupport/MFSamples/JCL/JCL.xml'
  environment: 
    COBDIR: '{{ installPath }}'