- name: Copy ES 8.0 PU 3 Installer to EC2 Instance
  copy:
    src: /products/setup_ent_server_8.0_patchupdate03_312109_redhat_x86_64
    dest: "/home/{{ myUsername }}/MFSupport/MFInstallers/setup_ent_server_8.0_patchupdate03_312109_redhat_x86_64"
    owner: support 
    group: support
    mode: '0775'

- name: Install ES 8.0 PU 3
  command: "/home/{{ myUsername }}/MFSupport/MFInstallers/setup_ent_server_8.0_patchupdate03_312109_redhat_x86_64 -IacceptEULA -ESadminID={{ myUsername }} -il=/home/products/es80PU3"

- name: Add License Server
  lineinfile:
    path: /var/microfocuslicensing/bin/ces.ini
    state: present
    regexp: '^lshost'
    line: 'lshost = {{ licenseServer }}'

- name: Start MFDS
  command: tmux new -d -s mfds ". /home/products/es80PU3/bin/cobsetenv && /home/products/es80PU3/bin/mfds"
  environment: 
    COBDIR: /home/products/es80PU3

- name: Start ESCWA
  command: tmux new -d -s escwa /home/products/es80PU3/bin/escwa --BasicConfig.MfRequestedEndpoint="tcp:*:10086" --write=true
  environment: 
    COBDIR: /home/products/es80PU3

- name: Import JCL Region
  command: /home/products/es80PU3/bin/mfds -g 5 /home/{{ myUsername }}/MFSupport/MFSamples/JCL/JCL.xml
  environment: 
    COBDIR: /home/products/es80PU3